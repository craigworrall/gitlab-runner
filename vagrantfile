require "vagrant-aws"

# Creating and configuring the AWS instance
Vagrant.configure('2') do |config|

    # Use dummy AWS box
    config.vm.box = 'aws-dummy'

    # Specify configuration of AWS provider
    config.vm.provider 'aws' do |aws, override|

        # Read AWS authentication information from environment variables
        aws.access_key_id = ENV['AWS_ACCESS_KEY_ID']
        aws.secret_access_key = ENV['AWS_SECRET_ACCESS_KEY']

        # Specify SSH keypair to use
        aws.keypair_name = 'gitlabrunner'

        # Specify region, AMI ID, Instance and security group
        aws.region = 'ap-southeast-2'
        aws.ami = 'ami-ee51f78c'
        aws.instance_type = 't2.medium'
        aws.security_groups = ['vagrant']

        # Specify username and private key path
        override.ssh.username = 'ubuntu'
        override.ssh.private_key_path = '~/.ssh/gitlabrunner.pem'
    end

    config.vm.provision "ansible" do |ansible|
        ansible.playbook = 'site.yml'
        ansible.verbose  = 'v'
    end

end
